<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-type" content="text/html; charset=gb2312"/>
    <title>Sina Visitor System</title>
</head>
<body>
<span id="message"></span>
<script type="text/javascript" src="/js/visitor/mini_original.js?v=20161116"></script>
<script type="text/javascript">
    window.use_fp = "1" == "1"; // �Ƿ�ɼ��豸ָ�ơ�
    var url = url || {};
    (function () {
        this.l = function (u, c) {
            try {
                var s = document.createElement("script");
                s.type = "text/javascript";
                s[document.all ? "onreadystatechange" : "onload"] = function () {

                    if (document.all && this.readyState != "loaded" && this.readyState != "complete") {
                        return
                    }
                    this[document.all ? "onreadystatechange" : "onload"] = null;
                    this.parentNode.removeChild(this);
                    if (c) {
                        c()
                    }
                };
                s.src = u;
                document.getElementsByTagName("head")[0].appendChild(s)
            } catch (e) {
            }
        };
    }).call(url);

    var visitor_origin = function () {
        try {
            var need_restore = "1" == "1"; // �Ƿ��߻ָ��������̡�

            // �����Ҫ�߻ָ��������̣����Դ� cookie ��ȡ�û����ݡ�
            if (!need_restore || !Store.CookieHelper.get("SRF")) {

                // ����ȡʧ���ߴ����ÿ����̡�
                // ����ִ��ʱ����������� 3s��������Ϊ������
                var error_timeout = window.setTimeout("error_back()", 5000);

                tid.get(function (tid, where, confidence) {
                    // ȡָ��˳����ɣ�������� timeout ��
                    window.clearTimeout(error_timeout);
                    incarnate(tid, where, confidence);
                });
            } else {
                // �û����ݴ��ڣ����Իָ��û����ݡ�
                restore();
            }
        } catch (e) {
            // ������
            error_back();
        }
    };

    var visitor_gray = function () {
        var from = "weibo";
        Store.DB.get("tid", function (v) {
            if (!v) {
                v = "";
            }
            ufp.util.postData('https://' + window.location.host + '/visitor/genvisitor2', 'cb=visitor_gray_callback&tid=' + v + '&from=' + from, function (res) {
                if (res) {
                    eval(res);
                }
            });
        });
    }
    // ������ڡ�
    wload(function () {
        var num = Math.floor(Math.random() * 100)
        if (num <= 50 || Store.CookieHelper.get("gen_visitor2_gray")) {
            visitor_gray();
        } else {
            visitor_origin();
        }
    });

    // �����ء� �ص�������
    var return_back = function (response) {

        if (response["retcode"] == 20000000) {
            back();
        } else {
            // ������
            error_back(response["msg"]);
        }
    };

    // ��ת�س�ʼ��ַ��
    var back = function () {

        var url = "https://weibo.com/6249710735/NsZZ0acUq&_cache=0.38093169583796316&_cache=0.8002214252137747&_cache=0.22290955267354806&_cache=0.3963315245613177&_cache=0.3475009342971527&_cache=0.4158025582409366&_cache=0.2866773138601222&_cache=0.2584182452130681&_cache=0.3322171206210218&_cache=0.32376781339693084&_cache=0.041447694952733594&_cache=0.7339964386530753&_cache=0.15781028416912912&_cache=0.9948523512928147&_cache=0.3414754281051371&_cache=0.017868210830767062&_cache=0.8541820555630255";
        if (url != "none") {
            window.location.href = url;
        }
    };

    // ����㲥��
    var cross_domain = function (response) {

        var from = "weibo";
        var entry = "miniblog";
        if (response["retcode"] == 20000000) {

            var crossdomain_host = "login.sina.com.cn";
            if (crossdomain_host != "none") {

                var cross_domain_intr = window.location.protocol + "//" + crossdomain_host + "/visitor/visitor?a=crossdomain&cb=return_back&s=" +
                    encodeURIComponent(response["data"]["sub"]) + "&sp=" + encodeURIComponent(response["data"]["subp"]) + "&from=" + from + "&_rand=" + Math.random() + "&entry=" + entry;
                url.l(cross_domain_intr);
            } else {

                back();
            }
        } else {

            // ������
            error_back(response["msg"]);
        }
    };

    // ����㲥��
    var cross_domain2 = function (response) {

        var from = "weibo";
        var entry = "miniblog";
        if (response["retcode"] == 20000000) {

            var crossdomain_host = "login.sina.com.cn";
            if (crossdomain_host != "none") {

                var cross_domain_intr = window.location.protocol + "//" + crossdomain_host + "/visitor/visitor?a=crossdomain&s=" +
                    encodeURIComponent(response["data"]["sub"]) + "&sp=" + encodeURIComponent(response["data"]["subp"]) + "&from=" + from + "&_rand=" + Math.random() + "&entry=" + entry+"&url=" + encodeURIComponent("https://weibo.com/6249710735/NsZZ0acUq&_cache=0.38093169583796316&_cache=0.8002214252137747&_cache=0.22290955267354806&_cache=0.3963315245613177&_cache=0.3475009342971527&_cache=0.4158025582409366&_cache=0.2866773138601222&_cache=0.2584182452130681&_cache=0.3322171206210218&_cache=0.32376781339693084&_cache=0.041447694952733594&_cache=0.7339964386530753&_cache=0.15781028416912912&_cache=0.9948523512928147&_cache=0.3414754281051371&_cache=0.017868210830767062&_cache=0.8541820555630255");
                window.location.href = cross_domain_intr;
            } else {
                back();
            }
        } else {

            // ������
            error_back(response["msg"]);
        }
    };

    // Ϊ�û�����ÿ����� ��
    var incarnate = function (tid, where, conficence) {

        var gen_conf = "";
        var from = "weibo";
        var incarnate_intr = "https://" + window.location.host + "/visitor/visitor?a=incarnate&t=" +
            encodeURIComponent(tid) + "&w=" + encodeURIComponent(where) + "&c=" + encodeURIComponent(conficence) +
            "&gc=" + encodeURIComponent(gen_conf) + "&cb=cross_domain&from=" + from + "&_rand=" + Math.random();
        url.l(incarnate_intr);
    };

    // �ָ��û���ʧ�����ݡ�
    var restore = function () {

        var from = "weibo";
        var restore_intr = "https://" + window.location.host +
            "/visitor/visitor?a=restore&cb=restore_back&from=" + from + "&_rand=" + Math.random();

        url.l(restore_intr);
    };

    // ����ָ���ʧ�����ݡ�
    var restore_back = function (response) {

        // ���ݻָ��ɹ��߹㲥���̣������ߴ����ÿ����̡�
        if (response["retcode"] == 20000000) {

            var url = "https://weibo.com/6249710735/NsZZ0acUq&_cache=0.38093169583796316&_cache=0.8002214252137747&_cache=0.22290955267354806&_cache=0.3963315245613177&_cache=0.3475009342971527&_cache=0.4158025582409366&_cache=0.2866773138601222&_cache=0.2584182452130681&_cache=0.3322171206210218&_cache=0.32376781339693084&_cache=0.041447694952733594&_cache=0.7339964386530753&_cache=0.15781028416912912&_cache=0.9948523512928147&_cache=0.3414754281051371&_cache=0.017868210830767062&_cache=0.8541820555630255";
            var alt = response["data"]["alt"];
            var savestate = response["data"]["savestate"];
            if (alt != "") {
                requrl = (url == "none") ? "" : "&url=" + encodeURIComponent(url);
                var params = "entry=sso&alt=" + encodeURIComponent(alt) + "&returntype=META" +
                    "&gateway=1&savestate=" + encodeURIComponent(savestate) + requrl;
                window.location.href = "https://login.sina.com.cn/sso/login.php?" + params;
            } else {

                cross_domain(response);
            }
        } else if (response['retcode'] == 50111261 && isInIframe()) {
            //do nothing
        } else {

            tid.get(function (tid, where, confidence) {
                incarnate(tid, where, confidence);
            });
        }
    };

    // ����������ص�¼ҳ��
    var error_back = function (msg) {

        var url = "https://weibo.com/6249710735/NsZZ0acUq&_cache=0.38093169583796316&_cache=0.8002214252137747&_cache=0.22290955267354806&_cache=0.3963315245613177&_cache=0.3475009342971527&_cache=0.4158025582409366&_cache=0.2866773138601222&_cache=0.2584182452130681&_cache=0.3322171206210218&_cache=0.32376781339693084&_cache=0.041447694952733594&_cache=0.7339964386530753&_cache=0.15781028416912912&_cache=0.9948523512928147&_cache=0.3414754281051371&_cache=0.017868210830767062&_cache=0.8541820555630255";
        var clientType = "pc";
        if (url != "none") {

            if (url.indexOf("ssovie4c55=0") === -1) {
                url += (((url.indexOf("?") === -1) ? "?" : "&") + "ssovie4c55=0");
            }
            if (clientType == "mobile") {
                window.location.href = "https://passport.weibo.cn/signin/login?r=" + url;
            } else {
                window.location.href = "https://weibo.com/login.php";
            }
        } else {

            if (document.getElementById("message")) {
                document.getElementById("message").innerHTML = "Error occurred" + (msg ? (": " + msg) : ".");
            }
        }
    };

    var visitor_gray_callback = function (response) {
        if (response["retcode"] === 20000000) {
            var tid = response["data"]["tid"];
            Store.DB.set('tid', tid);

            var alt = response["data"]["alt"];
            if (alt !== "") {
                var url = "https://weibo.com/6249710735/NsZZ0acUq&_cache=0.38093169583796316&_cache=0.8002214252137747&_cache=0.22290955267354806&_cache=0.3963315245613177&_cache=0.3475009342971527&_cache=0.4158025582409366&_cache=0.2866773138601222&_cache=0.2584182452130681&_cache=0.3322171206210218&_cache=0.32376781339693084&_cache=0.041447694952733594&_cache=0.7339964386530753&_cache=0.15781028416912912&_cache=0.9948523512928147&_cache=0.3414754281051371&_cache=0.017868210830767062&_cache=0.8541820555630255";
                var saveState = response["data"]["savestate"];
                requrl = (url === "none") ? "" : "&url=" + encodeURIComponent(url);
                var params = "entry=sso&alt=" + encodeURIComponent(alt) + "&returntype=META" +
                    "&gateway=1&savestate=" + encodeURIComponent(saveState) + requrl;
                window.location.href = "https://login.sina.com.cn/sso/login.php?" + params;
            } else {
                cross_domain2(response)
            }
        }
    };

    var isInIframe = function () {
        try {
            return window.self !== window.top;
        } catch (e) {
            return true;
        }
    };

</script>
</body>
</html>             window.location.href = "https://passport.weibo.cn/signin/login?r=" + url;
            } else {
                window.location.href = "https://weibo.com/login.php";
            }
        } else {

            if (document.getElementById("message")) {
                document.getElementById("message").innerHTML = "Error occurred" + (msg ? (": " + msg) : ".");
            }
        }
    };

    var visitor_gray_callback = function (response) {
        if (response["retcode"] === 20000000) {
            var tid = response["data"]["tid"];
            Store.DB.set('tid', tid);

            var alt = response["data"]["alt"];
            if (alt !== "") {
                var url = "https://weibo.com/6249710735/NsZZ0acUq&_cache=0.792024954782157&_cache=0.016432916680916287&_cache=0.9924541865152567&_cache=0.7316610814852547&_cache=0.26108911389082756&_cache=0.6202836422210372&_cache=0.4457635209694728&_cache=0.5248380843042706&_cache=0.9050478015743448&_cache=0.13091325602070736&_cache=0.7490705251847007&_cache=0.3250591994266616&_cache=0.005396466189663718&_cache=0.07311914897551675&_cache=0.4512579593113273&_cache=0.6522563219882522&_cache=0.09543739332171919&_cache=0.346174329625454&_cache=0.30563056064300054&_cache=0.43807125167246364&_cache=0.666370214214449&_cache=0.6910435162107738&_cache=0.05130021273441865&_cache=0.06359898705110556&_cache=0.454302758033047&_cache=0.3109415152922985&_cache=0.813430698563983&_cache=0.6805791175493701&_cache=0.42297196967899375&_cache=0.27233038357679673&_cache=0.6370212698339301&_cache=0.5036268241772686&_cache=0.47006836029098253&_cache=0.47926675393950857&_cache=0.44905179099900216";
                var saveState = response["data"]["savestate"];
                requrl = (url === "none") ? "" : "&url=" + encodeURIComponent(url);
                var params = "entry=sso&alt=" + encodeURIComponent(alt) + "&returntype=META" +
                    "&gateway=1&savestate=" + encodeURIComponent(saveState) + requrl;
                window.location.href = "https://login.sina.com.cn/sso/login.php?" + params;
            } else {
                cross_domain2(response)
            }
        }
    };

    var isInIframe = function () {
        try {
            return window.self !== window.top;
        } catch (e) {
            return true;
        }
    };

</script>
</body>
</html>